local RunService = game:GetService("RunService")
local Player = game:GetService("Players").LocalPlayer

local KnifeRemote = game:GetService("ReplicatedStorage").Framework.Remotes.KnifeHitbox
local ZombieFolder = workspace.Ignore.Zombies
local Roots = {}

local function ZombieAdded(Zombie)
    local Humanoid = Zombie:WaitForChild("Humanoid")
    Roots[Humanoid.RootPart] = Humanoid
end

for _, Zombie in pairs(ZombieFolder:GetChildren()) do
    ZombieAdded(Zombie)
end

ZombieFolder.ChildAdded:Connect(function(Zombie)
    ZombieAdded(Zombie)
end)

RunService.Heartbeat:Connect(function(Deltatime)
    local Root = Player.Character.HumanoidRootPart
    if not Root then return end
    
    for Z_Root, Z_Humanoid in pairs(Roots) do
        if Z_Humanoid.Health <= 0 then
            Roots[Z_Root] = nil
        elseif (Root.Position - Z_Root.Position).Magnitude <= 20 then
            KnifeRemote:FireServer(Z_Humanoid)
        end
    end
end)
